{% extends "base.html" %}

{% block title %}Profile Settings - Army Memo Maker{% endblock %}

{% block content %}
<div class="modern-card fade-in" style="max-width: 600px; margin: var(--spacing-16) auto;">
  <div class="modern-card-header">
    <h2 class="modern-card-title">Profile Settings</h2>
    <p class="modern-card-description">Set your default information to automatically populate in all memos</p>
  </div>

  <form action="" method="post" novalidate class="modern-form">
    {{ form.hidden_tag() }}

    <!-- Personal Information Section -->
    <div style="margin-bottom: var(--spacing-8);">
      <h3 class="section-heading">Personal Information</h3>
      <div class="section-divider"></div>

      <div class="modern-form-group">
        <label for="{{ form.full_name.id }}" class="modern-form-label">{{ form.full_name.label.text }}</label>
        {{ form.full_name(class="modern-form-input") }}
        {% for error in form.full_name.errors %}
        <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
          {{ error }}
        </div>
        {% endfor %}
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr 2fr; gap: var(--spacing-4);">
        <div class="modern-form-group">
          <label for="{{ form.rank.id }}" class="modern-form-label">{{ form.rank.label.text }}</label>
          {{ form.rank(class="modern-form-input") }}
          {% for error in form.rank.errors %}
          <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
            {{ error }}
          </div>
          {% endfor %}
        </div>

        <div class="modern-form-group">
          <label for="{{ form.branch.id }}" class="modern-form-label">{{ form.branch.label.text }}</label>
          {{ form.branch(class="modern-form-input") }}
          {% for error in form.branch.errors %}
          <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
            {{ error }}
          </div>
          {% endfor %}
        </div>

        <div class="modern-form-group">
          <label for="{{ form.title.id }}" class="modern-form-label">{{ form.title.label.text }}</label>
          {{ form.title(class="modern-form-input") }}
          {% for error in form.title.errors %}
          <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
            {{ error }}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Organization Information Section -->
    <div style="margin-bottom: var(--spacing-8);">
      <h3 class="section-heading">Organization Information</h3>
      <div class="section-divider"></div>

      <div class="modern-form-group">
        <label for="{{ form.organization_name.id }}" class="modern-form-label">{{ form.organization_name.label.text }}</label>
        {{ form.organization_name(class="modern-form-input") }}
        {% for error in form.organization_name.errors %}
        <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
          {{ error }}
        </div>
        {% endfor %}
      </div>

      <div class="modern-form-group">
        <label for="{{ form.organization_street.id }}" class="modern-form-label">{{ form.organization_street.label.text }}</label>
        {{ form.organization_street(class="modern-form-input") }}
        {% for error in form.organization_street.errors %}
        <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
          {{ error }}
        </div>
        {% endfor %}
      </div>

      <div class="modern-form-group">
        <label for="{{ form.organization_city_state_zip.id }}" class="modern-form-label">{{ form.organization_city_state_zip.label.text }}</label>
        {{ form.organization_city_state_zip(class="modern-form-input") }}
        {% for error in form.organization_city_state_zip.errors %}
        <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
          {{ error }}
        </div>
        {% endfor %}
      </div>

      <div class="modern-form-group">
        <label for="{{ form.office_symbol.id }}" class="modern-form-label">{{ form.office_symbol.label.text }}</label>
        {{ form.office_symbol(class="modern-form-input") }}
        {% for error in form.office_symbol.errors %}
        <div class="modern-alert modern-alert-error" style="margin-top: var(--spacing-2);">
          {{ error }}
        </div>
        {% endfor %}
      </div>
    </div>

    <div style="display: flex; gap: var(--spacing-4); justify-content: flex-end;">
      <a href="{{ url_for('index') }}" class="modern-btn modern-btn-secondary">Cancel</a>
      {{ form.submit(class="modern-btn modern-btn-primary") }}
    </div>
  </form>
</div>

{% if config.GOOGLE_CLIENT_ID %}
<!-- Google Account Section -->
<div class="modern-card fade-in fade-in-delay-1" style="max-width: 600px; margin: var(--spacing-8) auto;">
  <div style="margin-bottom: var(--spacing-6);">
    <h3 class="section-heading">Connected Accounts</h3>
    <div class="section-divider"></div>

    <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-4); background: var(--color-gray-50); border-radius: var(--radius-lg);">
      <div style="display: flex; align-items: center; gap: var(--spacing-3);">
        <svg width="24" height="24" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
          <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
          <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/>
          <path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/>
          <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/>
        </svg>
        <div>
          <div style="font-weight: var(--font-weight-medium); color: var(--color-gray-900);">Google Account</div>
          {% if current_user.is_google_linked() %}
          <div style="font-size: var(--font-size-sm); color: var(--color-gray-500);">{{ current_user.google_email }}</div>
          {% else %}
          <div style="font-size: var(--font-size-sm); color: var(--color-gray-500);">Not connected</div>
          {% endif %}
        </div>
      </div>

      {% if current_user.is_google_linked() %}
      <form action="{{ url_for('oauth.google_unlink') }}" method="post" style="margin: 0;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="modern-btn modern-btn-secondary" style="padding: var(--spacing-2) var(--spacing-4);"
          {% if not current_user.can_use_password() %}
          disabled title="Set a password first to unlink Google"
          {% endif %}
        >
          Unlink
        </button>
      </form>
      {% else %}
      <a href="{{ url_for('oauth.google_link') }}" class="modern-btn modern-btn-primary" style="padding: var(--spacing-2) var(--spacing-4);">
        Link Account
      </a>
      {% endif %}
    </div>

    {% if current_user.is_google_linked() and not current_user.can_use_password() %}
    <p style="margin-top: var(--spacing-3); font-size: var(--font-size-sm); color: var(--color-warning);">
      To unlink your Google account, you must first set a password so you can still log in.
    </p>
    {% endif %}
  </div>
</div>
{% endif %}

<div class="modern-card fade-in fade-in-delay-1" style="max-width: 600px; margin: var(--spacing-8) auto; background: linear-gradient(135deg, var(--color-gray-50) 0%, var(--color-gray-100) 100%);">
  <div class="text-center">
    <h3 class="font-semibold mb-4">How Profile Settings Work</h3>
    <div class="text-sm" style="color: var(--color-gray-600); line-height: var(--line-height-relaxed);">
      <div style="margin-bottom: var(--spacing-3);">üìù Your profile information automatically populates in memo forms</div>
      <div style="margin-bottom: var(--spacing-3);">üîÑ Text files use placeholders that get replaced with your values</div>
      <div style="margin-bottom: var(--spacing-3);">‚ö° Saves time by eliminating repetitive data entry</div>
      <div>üéØ Ensures consistency across all your military correspondence</div>
    </div>
  </div>
</div>

<style>
.section-heading {
  font-size: var(--text-lg);
  font-weight: 600;
  color: var(--color-gray-900);
  margin-bottom: var(--spacing-3);
}

.section-divider {
  height: 2px;
  background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
  border-radius: 1px;
  margin-bottom: var(--spacing-6);
}

@media (max-width: 768px) {
  div[style*="grid-template-columns"] {
    grid-template-columns: 1fr !important;
  }
}
</style>
{% endblock %}
