{% extends 'base.html' %}

{% block title %}Army Memo Maker - Professional Military Documents{% endblock %}

{% block hero %}
<div class="modern-hero fade-in">
  <h1>Army Memo Maker</h1>
  <p>
    Create professional military memorandums in accordance with AR 25-50.
    Simple markdown-like syntax, LaTeX-powered formatting.
  </p>
</div>
{% endblock %}

{% block top_info %}
{% from "example_list.html" import build_list %}
<div class="fade-in">
  {{ build_list('index', examples) }}
</div>
{% endblock %}

{% block content %}
<div class="modern-card fade-in">
  <div class="modern-card-header">
    <h2 class="modern-card-title">Memo Editor</h2>
    <p class="modern-card-description">
      Type your memo content below using simple markdown-like syntax. Variables like <span class="variable">&#123;&#123;ORGANIZATION_NAME&#125;&#125;</span>, <span class="variable">&#123;&#123;AUTHOR&#125;&#125;</span>, and <span class="variable">&#123;&#123;DATE&#125;&#125;</span> will be automatically rendered by LaTeX into properly formatted memo headers and signatures.
      The tutorial example shows you the syntax. Need help? Try the <a href="/form" style="color: var(--color-primary); text-decoration: none; font-weight: 500;">Form Builder</a>.
    </p>
  </div>

  <form id="memo" method="post" class="modern-form">
    <div class="modern-form-group">
      <textarea
        name="memo_text"
        id="editor"
        spellcheck="true"
        class="modern-form-textarea large"
        placeholder="Start typing your memo content here...">{{memo_text}}</textarea>
    </div>

    <div style="display: flex; gap: var(--spacing-4); flex-wrap: wrap; justify-content: flex-start; align-items: center;">
      <button type="submit" class="modern-btn modern-btn-primary modern-btn-lg" id="start-bg-job">
        Create Memo PDF
      </button>
      {% if current_user.is_authenticated %}
      <button type="button" class="modern-btn modern-btn-outline" id="save-progress">
        Save Progress
      </button>
      {% endif %}
      <button type="button" class="modern-btn modern-btn-ghost" id="batch-upload-btn">
        üìÅ Batch Upload Files
      </button>
    </div>
  </form>
</div>

<!-- Batch Upload Modal -->
<div id="batch-upload-modal" class="modern-modal" style="display: none;">
  <div class="modern-modal-content">
    <div class="modern-modal-header">
      <h3>Batch Upload Files</h3>
      <button id="batch-modal-close" class="modern-modal-close">&times;</button>
    </div>

    <div class="modern-modal-body">
      <!-- File Upload Area -->
      <div id="file-upload-area" class="upload-area">
        <div class="upload-text">
          <strong>üìÅ Click to select files or drag and drop</strong>
          <p>Upload up to 5 text files (max 50KB each)</p>
          <p style="font-size: 0.875rem; color: var(--color-gray-500);">
            Supported: .txt, .md, .text, .markdown, .amd files
          </p>
        </div>
        <input type="file" id="file-input" multiple accept=".txt,.md,.text,.markdown,.amd" style="display: none;">
      </div>

      <!-- Selected Files List -->
      <div id="file-list" style="display: none;">
        <h4>Selected Files:</h4>
        <ul id="selected-files" class="selected-files-list"></ul>
        <div style="margin-top: var(--spacing-4);">
          <button id="clear-files" class="modern-btn modern-btn-ghost modern-btn-sm">Clear All</button>
          <button id="process-files" class="modern-btn modern-btn-primary" disabled>Process Files</button>
        </div>
      </div>

      <!-- Progress -->
      <div id="batch-progress" style="display: none;">
        <h4>Processing Files...</h4>
        <div class="modern-progress-bar">
          <div id="batch-progress-bar" class="modern-progress-fill" style="width: 0%"></div>
        </div>
        <div id="batch-status" class="batch-status"></div>
      </div>

      <!-- Results -->
      <div id="batch-results" style="display: none;">
        <h4>Results:</h4>
        <ul id="results-list" class="results-list"></ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='tasks.js') }}"></script>
<script src="{{ url_for('static', filename='index.js') }}"></script>
<script src="{{ url_for('static', filename='batch-upload.js') }}"></script>
<script src="{{ url_for('static', filename='validation-rules.js') }}"></script>
<script src="{{ url_for('static', filename='text-editor-validation.js') }}"></script>
<script src="{{ url_for('static', filename='auto-save.js') }}"></script>
<script src="{{ url_for('static', filename='keyboard-shortcuts.js') }}"></script>
{% endblock %}
